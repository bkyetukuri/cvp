namespace vp;

// ============================================================
// ============================================================
//  FINAL TABLES (Processed / Clean Layer - With Managed Fields)
// ============================================================
// ============================================================

entity ServiceOrder_H : cuid, managed {
  key headerID              : UUID;
  orderID                   : String(35);
  orderType                 : String(4);
  orgUnit                   : Composition of SalesArea;
  description               : String(40);
  language                  : String(9);
  soldToParty               : String(10);
  soldToPartyName           : String(60);
  serviceParty              : String(10);
  servicePartyName          : String(60);
  requestType               : String;
  serviceType               : String;
  serviceSubType            : String;
  priority                  : String(1);
  fnaStatus                 : String(3);
  confirmationNeeded        : String;
  requestedStartDateTime    : Timestamp;
  requestedEndDateTime      : Timestamp;
  documentDataTimestamp     : Timestamp;
  status                    : Composition of Status;
  customerPO                : String;
  customerRef10             : String;
  customerName3             : String;

  items        : Composition of many ServiceOrder_I     on items.header = $self;
  partners     : Composition of many PartnerDetail      on partners.header = $self;
  appointments : Composition of many AppointmentDetail  on appointments.header = $self;
  texts        : Composition of many LongTextDetail     on texts.header = $self;

  // Association to Conversations
  conversations : Association to many Conversations on conversations.socServiceOrder = $self;
}

entity ServiceOrder_I : cuid, managed {
  key itemID : UUID;

  header                : Association to ServiceOrder_H;
  itemNo                : String(6);
  parentItem            : String(6);
  product               : String(40);
  productDesc           : String(40);
  language              : String(9);
  quantity              : Decimal(13,3);
  quantityUnit          : String(3);
  itemCategory          : String(4);
  status                : Composition of Status;
  fnaStatus             : String(3);
  confirmationNeeded    : String;
  frequency             : String;
  materialGroup2        : String(3);
  materialGroup2Desc    : String(40);

  partners     : Composition of many PartnerDetail     on partners.item = $self;
  appointments : Composition of many AppointmentDetail on appointments.item = $self;
  texts        : Composition of many LongTextDetail    on texts.item = $self;
}

entity Status : cuid, managed {
  key statusID : UUID;
  isOpen       : Boolean;
  isReleased   : Boolean;
  isCompleted  : Boolean;
  isRejected   : Boolean;
  userStatus   : String(5);
}

entity PartnerDetail : cuid, managed {
  key partnerID : UUID;
  header           : Association to ServiceOrder_H;
  item             : Association to ServiceOrder_I;
  partnerFunction  : String(8);
  partnerNumber    : String(10);
  partnerName      : String(60);
  isMainPartner    : Boolean;
  numberType       : String(60);
  functionCategory : String(4);
  houseNumber      : String(10);
  streetName       : String(60);
  cityName         : String(40);
  region           : String(3);
  postalCode       : String(10);
  country          : String(3);
  dialCode         : String(10);
  phoneNumber      : String(10);
  phoneExtension   : String(10);
  emailAddress     : String(255);
}

entity AppointmentDetail : cuid, managed {
  key appointmentID : UUID;
  header            : Association to ServiceOrder_H;
  item              : Association to ServiceOrder_I;
  apptType          : String;
  apptStartDateTime : Timestamp;
  apptStartTimeZone : String(3);
  apptEndDateTime   : Timestamp;
  apptEndTimeZone   : String(3);
}

entity LongTextDetail : cuid, managed {
  key longTextID : UUID;
  header           : Association to ServiceOrder_H;
  item             : Association to ServiceOrder_I;
  longTextTypeID   : String(5);
  creationDateTime : Timestamp;
  text             : String;
  language         : String(9);
  actionCode       : String(2);
}

entity SalesArea : cuid, managed {
  key salesAreaID       : UUID;
  salesOrganization     : String(4);
  distributionChannel   : String(2);
  division              : String(2);
  salesOffice           : String(4);
  salesGroup            : String(3);
}

// ============================================================
// Conversations (New Entity Linked to ServiceOrder_H)
// ============================================================
entity Conversations : cuid, managed {
  key ServiceOrder : String(10);
  Messages         : String(5000);
  socServiceOrder  : Association to ServiceOrder_H;
}
